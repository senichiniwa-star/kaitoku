<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ç¯‰åœ°è²å¾³ äºˆç´„ç®¡ç†</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        body { font-family: 'Hiragino Sans', 'Yu Gothic', sans-serif; }
        .modal {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.5);
            z-index: 1000;
            align-items: center;
            justify-content: center;
            overflow-y: auto;
        }
        .modal.show {
            display: flex;
        }
    </style>
</head>
<body class="bg-gradient-to-br from-slate-50 to-slate-100 min-h-screen">
    <div id="app" class="p-4 md:p-6"></div>

    <!-- äºˆç´„è¿½åŠ /ç·¨é›†ãƒ¢ãƒ¼ãƒ€ãƒ« -->
    <div id="reservationModal" class="modal">
        <div class="bg-white rounded-xl shadow-2xl p-6 max-w-md w-full mx-4 my-8">
            <div class="flex items-center justify-between mb-6">
                <h2 id="modalTitle" class="text-2xl font-bold text-slate-800">äºˆç´„è¿½åŠ </h2>
                <button onclick="closeReservationModal()" class="text-slate-400 hover:text-slate-600 text-3xl">&times;</button>
            </div>
            
            <div class="space-y-4">
                <div>
                    <label class="block text-sm font-bold text-slate-700 mb-2">äºˆç´„æ—¥</label>
                    <input type="date" id="reservationDate" 
                        class="w-full px-4 py-2 border-2 border-slate-300 rounded-lg focus:border-blue-500 focus:outline-none">
                </div>

                <div>
                    <label class="block text-sm font-bold text-slate-700 mb-2">äºˆç´„è€…</label>
                    <select id="reservationName" 
                        class="w-full px-4 py-2 border-2 border-slate-300 rounded-lg focus:border-blue-500 focus:outline-none">
                    </select>
                </div>

                <div>
                    <label class="block text-sm font-bold text-slate-700 mb-2">äººæ•°</label>
                    <input type="number" id="reservationSeats" min="1" max="8" value="2"
                        class="w-full px-4 py-2 border-2 border-slate-300 rounded-lg focus:border-blue-500 focus:outline-none">
                    <p class="text-xs text-slate-500 mt-1">â€»æœ€å¤§8åã¾ã§</p>
                </div>

                <div>
                    <label class="block text-sm font-bold text-slate-700 mb-2">å‚™è€ƒï¼ˆä»»æ„ï¼‰</label>
                    <textarea id="reservationNotes" rows="3"
                        class="w-full px-4 py-2 border-2 border-slate-300 rounded-lg focus:border-blue-500 focus:outline-none"
                        placeholder="ç‰¹è¨˜äº‹é …ãŒã‚ã‚Œã°å…¥åŠ›"></textarea>
                </div>
            </div>

            <div class="mt-6 flex gap-3">
                <button onclick="saveReservation()" 
                    class="flex-1 bg-blue-600 hover:bg-blue-700 text-white font-bold py-3 rounded-lg transition-colors">
                    ä¿å­˜
                </button>
                <button onclick="closeReservationModal()" 
                    class="flex-1 bg-slate-300 hover:bg-slate-400 text-slate-700 font-bold py-3 rounded-lg transition-colors">
                    ã‚­ãƒ£ãƒ³ã‚»ãƒ«
                </button>
            </div>
            
            <button id="deleteReservationButton" onclick="deleteReservation()" 
                class="w-full mt-3 bg-red-600 hover:bg-red-700 text-white font-bold py-2 rounded-lg transition-colors hidden">
                ğŸ—‘ï¸ ã“ã®äºˆç´„ã‚’å‰Šé™¤
            </button>
        </div>
    </div>

    <!-- äºˆç´„è€…ç®¡ç†ãƒ¢ãƒ¼ãƒ€ãƒ« -->
    <div id="customerModal" class="modal">
        <div class="bg-white rounded-xl shadow-2xl p-6 max-w-2xl w-full mx-4 my-8 max-h-[90vh] overflow-y-auto">
            <div class="flex items-center justify-between mb-6">
                <h2 class="text-2xl font-bold text-slate-800">äºˆç´„è€…ç®¡ç†</h2>
                <button onclick="closeCustomerModal()" class="text-slate-400 hover:text-slate-600 text-3xl">&times;</button>
            </div>

            <!-- äºˆç´„è€…è¿½åŠ  -->
            <div class="mb-6 p-4 bg-slate-50 rounded-lg">
                <h3 class="font-bold text-slate-700 mb-3">æ–°ã—ã„äºˆç´„è€…ã‚’è¿½åŠ </h3>
                <div class="flex gap-2">
                    <input type="text" id="newCustomerName" placeholder="äºˆç´„è€…å"
                        class="flex-1 px-4 py-2 border-2 border-slate-300 rounded-lg focus:border-blue-500 focus:outline-none">
                    <button onclick="addCustomer()"
                        class="bg-blue-600 hover:bg-blue-700 text-white font-bold px-6 py-2 rounded-lg transition-colors">
                        è¿½åŠ 
                    </button>
                </div>
            </div>

            <!-- äºˆç´„è€…ãƒªã‚¹ãƒˆ -->
            <div>
                <h3 class="font-bold text-slate-700 mb-3">äºˆç´„è€…ãƒªã‚¹ãƒˆ</h3>
                <div id="customerList" class="space-y-2"></div>
            </div>

            <div class="mt-6">
                <button onclick="closeCustomerModal()"
                    class="w-full bg-slate-600 hover:bg-slate-700 text-white font-bold py-3 rounded-lg transition-colors">
                    é–‰ã˜ã‚‹
                </button>
            </div>
        </div>
    </div>

    <script>
        const DEFAULT_CUSTOMERS = [
            'æ¤å', 'è±Šåœ‹', 'å‘‚', 'åŠ è—¤', 'ä¸¹ç¾½', 'å°æ—©å·', 
            'çŸ³ç”°', 'ç¨®è°·', 'å±±æ‘', 'å¤§å³¶', 'èµ¤å·', 'å¸‚å ´', 'ãƒãƒ¼ã‚¯'
        ];

        const COLOR_PALETTE = [
            'bg-blue-100 border-blue-300 text-blue-800',
            'bg-green-100 border-green-300 text-green-800',
            'bg-purple-100 border-purple-300 text-purple-800',
            'bg-pink-100 border-pink-300 text-pink-800',
            'bg-yellow-100 border-yellow-300 text-yellow-800',
            'bg-indigo-100 border-indigo-300 text-indigo-800',
            'bg-red-100 border-red-300 text-red-800',
            'bg-orange-100 border-orange-300 text-orange-800',
            'bg-teal-100 border-teal-300 text-teal-800',
            'bg-cyan-100 border-cyan-300 text-cyan-800',
            'bg-lime-100 border-lime-300 text-lime-800',
            'bg-emerald-100 border-emerald-300 text-emerald-800',
            'bg-violet-100 border-violet-300 text-violet-800',
            'bg-fuchsia-100 border-fuchsia-300 text-fuchsia-800',
            'bg-rose-100 border-rose-300 text-rose-800',
            'bg-sky-100 border-sky-300 text-sky-800',
            'bg-amber-100 border-amber-300 text-amber-800'
        ];

        let reservations = [];
        let customers = [];
        let customerColors = {};
        let currentMonth = new Date(2026, 0, 1);
        let editingReservationId = null;

        function initializeCustomers() {
            try {
                const saved = localStorage.getItem('kaitoku_customers');
                if (saved) {
                    customers = JSON.parse(saved);
                } else {
                    customers = [...DEFAULT_CUSTOMERS];
                    saveCustomers();
                }
                
                // ã‚«ãƒ©ãƒ¼å‰²ã‚Šå½“ã¦
                customers.forEach((name, index) => {
                    if (!customerColors[name]) {
                        customerColors[name] = COLOR_PALETTE[index % COLOR_PALETTE.length];
                    }
                });
            } catch (e) {
                console.error('äºˆç´„è€…ãƒ‡ãƒ¼ã‚¿èª­ã¿è¾¼ã¿ã‚¨ãƒ©ãƒ¼:', e);
                customers = [...DEFAULT_CUSTOMERS];
            }
        }

        function saveCustomers() {
            try {
                localStorage.setItem('kaitoku_customers', JSON.stringify(customers));
            } catch (e) {
                console.error('äºˆç´„è€…ãƒ‡ãƒ¼ã‚¿ä¿å­˜ã‚¨ãƒ©ãƒ¼:', e);
            }
        }

        function addCustomer() {
            const input = document.getElementById('newCustomerName');
            const name = input.value.trim();
            
            if (!name) {
                alert('äºˆç´„è€…åã‚’å…¥åŠ›ã—ã¦ãã ã•ã„');
                return;
            }
            
            if (customers.includes(name)) {
                alert('æ—¢ã«ç™»éŒ²ã•ã‚Œã¦ã„ã‚‹äºˆç´„è€…ã§ã™');
                return;
            }
            
            customers.push(name);
            customerColors[name] = COLOR_PALETTE[customers.length % COLOR_PALETTE.length];
            saveCustomers();
            input.value = '';
            renderCustomerModal();
            updateReservationNameSelect();
        }

        function deleteCustomer(name) {
            if (confirm(`ã€Œ${name}ã€ã‚’å‰Šé™¤ã—ã¾ã™ã‹ï¼Ÿ\nâ€»ã“ã®äºˆç´„è€…ã®äºˆç´„ãƒ‡ãƒ¼ã‚¿ã¯å‰Šé™¤ã•ã‚Œã¾ã›ã‚“`)) {
                customers = customers.filter(c => c !== name);
                delete customerColors[name];
                saveCustomers();
                renderCustomerModal();
                updateReservationNameSelect();
            }
        }

        function openCustomerModal() {
            const modal = document.getElementById('customerModal');
            renderCustomerModal();
            modal.classList.add('show');
        }

        function closeCustomerModal() {
            const modal = document.getElementById('customerModal');
            modal.classList.remove('show');
            render();
        }

        function renderCustomerModal() {
            const list = document.getElementById('customerList');
            list.innerHTML = customers.map(name => `
                <div class="flex items-center justify-between p-3 ${customerColors[name]} rounded-lg">
                    <span class="font-bold">${name}</span>
                    <button onclick="deleteCustomer('${name}')" 
                        class="text-red-600 hover:text-red-800 font-bold">
                        å‰Šé™¤
                    </button>
                </div>
            `).join('');
        }

        function updateReservationNameSelect() {
            const select = document.getElementById('reservationName');
            const currentValue = select.value;
            select.innerHTML = '<option value="">é¸æŠã—ã¦ãã ã•ã„</option>' + 
                customers.map(name => `<option value="${name}">${name}</option>`).join('');
            if (currentValue && customers.includes(currentValue)) {
                select.value = currentValue;
            }
        }

        function loadReservations() {
            try {
                const data = localStorage.getItem('kaitoku_reservations');
                if (data) {
                    reservations = JSON.parse(data);
                }
            } catch (e) {
                console.error('äºˆç´„ãƒ‡ãƒ¼ã‚¿èª­ã¿è¾¼ã¿ã‚¨ãƒ©ãƒ¼:', e);
            }
        }

        function saveReservations() {
            try {
                localStorage.setItem('kaitoku_reservations', JSON.stringify(reservations));
            } catch (e) {
                console.error('äºˆç´„ãƒ‡ãƒ¼ã‚¿ä¿å­˜ã‚¨ãƒ©ãƒ¼:', e);
            }
        }

        function changeMonth(delta) {
            currentMonth = new Date(currentMonth.getFullYear(), currentMonth.getMonth() + delta, 1);
            render();
        }

        function openReservationModal(date = null, reservation = null) {
            const modal = document.getElementById('reservationModal');
            const title = document.getElementById('modalTitle');
            const deleteBtn = document.getElementById('deleteReservationButton');

            updateReservationNameSelect();

            if (reservation) {
                title.textContent = 'äºˆç´„ç·¨é›†';
                document.getElementById('reservationDate').value = reservation.date;
                document.getElementById('reservationName').value = reservation.name;
                document.getElementById('reservationSeats').value = reservation.seats;
                document.getElementById('reservationNotes').value = reservation.notes || '';
                deleteBtn.classList.remove('hidden');
                editingReservationId = reservation.id;
            } else {
                title.textContent = 'äºˆç´„è¿½åŠ ';
                document.getElementById('reservationDate').value = date || '';
                document.getElementById('reservationName').value = '';
                document.getElementById('reservationSeats').value = '2';
                document.getElementById('reservationNotes').value = '';
                deleteBtn.classList.add('hidden');
                editingReservationId = null;
            }

            modal.classList.add('show');
        }

        function closeReservationModal() {
            const modal = document.getElementById('reservationModal');
            modal.classList.remove('show');
            editingReservationId = null;
        }

        function saveReservation() {
            const date = document.getElementById('reservationDate').value;
            const name = document.getElementById('reservationName').value;
            const seats = parseInt(document.getElementById('reservationSeats').value);
            const notes = document.getElementById('reservationNotes').value;

            if (!date || !name || !seats) {
                alert('æ—¥ä»˜ã€äºˆç´„è€…ã€äººæ•°ã¯å¿…é ˆã§ã™');
                return;
            }

            const sameDay = reservations.filter(r => r.date === date && r.id !== editingReservationId);
            const totalSeats = sameDay.reduce((sum, r) => sum + r.seats, 0) + seats;
            
            if (sameDay.length >= 2) {
                alert('åŒã˜æ—¥ã«æœ€å¤§2çµ„ã¾ã§äºˆç´„å¯èƒ½ã§ã™');
                return;
            }
            
            if (totalSeats > 8) {
                alert(`å¸­æ•°ãŒä¸è¶³ã—ã¦ã„ã¾ã™ï¼ˆä½¿ç”¨å¯èƒ½: ${8 - (totalSeats - seats)}å¸­ï¼‰`);
                return;
            }

            if (editingReservationId) {
                const index = reservations.findIndex(r => r.id === editingReservationId);
                if (index !== -1) {
                    reservations[index] = { id: editingReservationId, date, name, seats, notes };
                }
            } else {
                reservations.push({
                    id: Date.now(),
                    date,
                    name,
                    seats,
                    notes
                });
            }

            saveReservations();
            closeReservationModal();
            render();
        }

        function deleteReservation() {
            if (!editingReservationId) return;
            
            if (confirm('ã“ã®äºˆç´„ã‚’å‰Šé™¤ã—ã¾ã™ã‹ï¼Ÿ')) {
                reservations = reservations.filter(r => r.id !== editingReservationId);
                saveReservations();
                closeReservationModal();
                render();
            }
        }

        function getDaysInMonth(year, month) {
            return new Date(year, month + 1, 0).getDate();
        }

        function getFirstDayOfMonth(year, month) {
            return new Date(year, month, 1).getDay();
        }

        function formatDate(year, month, day) {
            return `${year}-${String(month + 1).padStart(2, '0')}-${String(day).padStart(2, '0')}`;
        }

        function getReservationsForDate(dateStr) {
            return reservations.filter(r => r.date === dateStr);
        }

        function render() {
            const year = currentMonth.getFullYear();
            const month = currentMonth.getMonth();
            const daysInMonth = getDaysInMonth(year, month);
            const firstDay = getFirstDayOfMonth(year, month);

            const monthNames = ['1æœˆ', '2æœˆ', '3æœˆ', '4æœˆ', '5æœˆ', '6æœˆ', '7æœˆ', '8æœˆ', '9æœˆ', '10æœˆ', '11æœˆ', '12æœˆ'];
            const dayNames = ['æ—¥', 'æœˆ', 'ç«', 'æ°´', 'æœ¨', 'é‡‘', 'åœŸ'];

            const canGoPrev = !(year === 2026 && month === 0);
            const canGoNext = !(year === 2026 && month === 11);

            let calendarHTML = '';
            let dayCounter = 1;

            for (let week = 0; week < 6; week++) {
                calendarHTML += '<div class="grid grid-cols-7 gap-2">';
                
                for (let day = 0; day < 7; day++) {
                    const cellIndex = week * 7 + day;
                    
                    if (cellIndex < firstDay || dayCounter > daysInMonth) {
                        calendarHTML += '<div class="aspect-square"></div>';
                    } else {
                        const dateStr = formatDate(year, month, dayCounter);
                        const dayReservations = getReservationsForDate(dateStr);
                        const isToday = dateStr === new Date().toISOString().split('T')[0];
                        
                        calendarHTML += `
                            <div class="aspect-square bg-white rounded-lg shadow hover:shadow-lg transition-shadow border-2 ${isToday ? 'border-blue-500' : 'border-slate-200'} p-2 flex flex-col">
                                <div class="text-sm font-bold mb-1 ${day === 0 ? 'text-red-600' : day === 6 ? 'text-blue-600' : 'text-slate-700'}">
                                    ${dayCounter}
                                </div>
                                <div class="flex-1 overflow-y-auto space-y-1">
                                    ${dayReservations.map(r => `
                                        <div onclick="openReservationModal(null, ${JSON.stringify(r).replace(/"/g, '&quot;')})" 
                                            class="text-xs p-1 rounded border-2 cursor-pointer hover:opacity-80 ${customerColors[r.name] || 'bg-slate-100 border-slate-300 text-slate-800'}">
                                            <div class="font-bold">${r.name}</div>
                                            <div>${r.seats}å</div>
                                        </div>
                                    `).join('')}
                                </div>
                                ${dayReservations.length < 2 ? `
                                    <button onclick="openReservationModal('${dateStr}')" 
                                        class="text-xs bg-slate-100 hover:bg-slate-200 text-slate-600 rounded py-1 mt-1 transition-colors">
                                        +
                                    </button>
                                ` : ''}
                            </div>
                        `;
                        dayCounter++;
                    }
                }
                
                calendarHTML += '</div>';
                
                if (dayCounter > daysInMonth) break;
            }

            const app = document.getElementById('app');
            app.innerHTML = `
                <div class="max-w-7xl mx-auto">
                    <div class="bg-white rounded-xl shadow-lg p-4 md:p-6 mb-6">
                        <div class="flex items-center justify-between flex-wrap gap-4">
                            <div>
                                <h1 class="text-2xl md:text-3xl font-bold text-slate-800 mb-2">äºˆç´„ç®¡ç†</h1>
                                <p class="text-slate-600">ç¯‰åœ°è²å¾³ ãƒ‡ã‚£ãƒŠãƒ¼äºˆç´„ï¼ˆæœ€å¤§8å¸­ãƒ»2çµ„ã¾ã§ï¼‰</p>
                            </div>
                            <div class="flex gap-2">
                                <button onclick="openCustomerModal()"
                                    class="bg-purple-600 hover:bg-purple-700 text-white font-medium px-4 py-2 rounded-lg transition-colors">
                                    ğŸ‘¥ äºˆç´„è€…ç®¡ç†
                                </button>
                                <a href="index.html" 
                                    class="bg-slate-600 hover:bg-slate-700 text-white font-medium px-4 py-2 rounded-lg transition-colors">
                                    â† ãƒˆãƒƒãƒ—ã¸
                                </a>
                            </div>
                        </div>
                    </div>

                    <div class="bg-white rounded-xl shadow-lg p-6 mb-6">
                        <div class="flex items-center justify-between">
                            <button onclick="changeMonth(-1)" 
                                ${!canGoPrev ? 'disabled class="opacity-50 cursor-not-allowed"' : ''}
                                class="bg-blue-600 hover:bg-blue-700 text-white font-bold px-4 py-2 rounded-lg transition-colors">
                                â† å‰æœˆ
                            </button>
                            <h2 class="text-2xl md:text-3xl font-bold text-slate-800">
                                ${year}å¹´ ${monthNames[month]}
                            </h2>
                            <button onclick="changeMonth(1)" 
                                ${!canGoNext ? 'disabled class="opacity-50 cursor-not-allowed"' : ''}
                                class="bg-blue-600 hover:bg-blue-700 text-white font-bold px-4 py-2 rounded-lg transition-colors">
                                æ¬¡æœˆ â†’
                            </button>
                        </div>
                    </div>

                    <div class="bg-white rounded-xl shadow-lg p-4 md:p-6">
                        <div class="grid grid-cols-7 gap-2 mb-2">
                            ${dayNames.map((name, i) => `
                                <div class="text-center font-bold text-sm ${i === 0 ? 'text-red-600' : i === 6 ? 'text-blue-600' : 'text-slate-700'}">
                                    ${name}
                                </div>
                            `).join('')}
                        </div>
                        ${calendarHTML}
                    </div>

                    <div class="bg-white rounded-xl shadow-lg p-6 mt-6">
                        <h3 class="font-bold text-slate-800 mb-4">äºˆç´„è€…ã‚«ãƒ©ãƒ¼</h3>
                        <div class="grid grid-cols-2 sm:grid-cols-3 md:grid-cols-4 lg:grid-cols-6 gap-3">
                            ${customers.map(name => `
                                <div class="flex items-center gap-2">
                                    <div class="w-4 h-4 rounded border-2 ${customerColors[name]}"></div>
                                    <span class="text-sm">${name}</span>
                                </div>
                            `).join('')}
                        </div>
                    </div>
                </div>
            `;
        }

        window.openReservationModal = openReservationModal;
        window.closeReservationModal = closeReservationModal;
        window.saveReservation = saveReservation;
        window.deleteReservation = deleteReservation;
        window.changeMonth = changeMonth;
        window.openCustomerModal = openCustomerModal;
        window.closeCustomerModal = closeCustomerModal;
        window.addCustomer = addCustomer;
        window.deleteCustomer = deleteCustomer;

        initializeCustomers();
        loadReservations();
        render();
    </script>
</body>
</html>